
---
title: "Homework 1 for SDS, Fall 2022"
author: "Cem Sirin & Vahid Ghanbarizadeh"
date: "`r Sys.Date()`"
---

## Exercise 1: Stat4Race (2nd ed.)

## Exercise 2: Mind your own biz. . .

### Building a business is never easy

Let's try simulating a Beta(10,10) distribution and plotting it.

```{r}
set.seed(123)
M <- 10^5
m <- 20
x <- rbeta(M, 10, 10)
hist(x, breaks = m, xlim = c(0,1), col = "lightblue", main = "Beta(10,10) distribution")
```

We will apply the Perturbed Histogram (Dwork et al., 2006) to privatize the data. The idea is to divide the data into $m$ bins, and then add a random noise to each bin. The noise is drawn from a Laplace distribution with scale parameter $\frac{\epsilon}{n}$, where $\epsilon$ is the privacy budget. The following code implements the Perturbed Histogram algorithm.

```{r}
rlaplace <- function(n, mu = 0, b = 1) {
  r <- runif(n, 0, 1)
  r <- mu - b * sign(r - 0.5) * log(1 - 2 * abs(r - 0.5))
  return(r)
}
perturb <- function(x, epsilon, m) {
  n <- length(x)
  bin <- cut(x, m)
  bin <- as.numeric(bin)
  # count the number of elements in each bin
  count <- table(bin)
  # add noise to each bin
  count <- count + rlaplace(m, 0, 8 / epsilon^2)
  # count 0 or max
  count[count < 0] <- 0
  # return the privatized probabilities
  return(count / sum(count))
}
```

Let's try privatizing the probabilities of our dataset with with $\epsilon = 1$, and $m = `r m`$.

```{r}
perturb(x, 1, m)
```

Let's try creating a new dataset by sampling from our privatized histogram.

```{r}
# privatized histogram
q <- perturb(x, 1, m) 
# sample from the privatized histogram
z <- sample(1:m, M, replace = TRUE, prob = q) 
z <- (z - 1) / m
hist(z, breaks = m, xlim = c(0,1), col = "lightcoral", main = "Perturbed Beta(10,10) distribution")
```

### Exercise 2.1

First we need to create a function that the Mean Integrated Squared Error (MISE) of a privatized histogram. The MISE is defined as

$$
\text{MISE}(\hat{p}, p) = \mathbb{E}\left[ \int_{0}^{1} (p(x) - \hat{p}(x))^2 \, \mathrm{d}x \right]
$$

where $\hat{p}(i)$ is the probability of the $i$th bin of the approximate histogram, and $p(i)$ is the probability of the $i$th bin of the original histogram.

```{r}
true_hist <- function(pdist, m) {
  pdist(1:m / m) - pdist((1:m - 1) / m)
}

mise <- function(original, approx, range, m) {
  return(range * sum((original - approx)^2) / m)
}

# Define true distribution
pdist <- function(x) pbeta(x, 10, 10)
p <- true_hist(pdist, m)
p
```


Let's put the MISE function to work. We will try different values of $\epsilon$ and $m$.

```{r}
mise(p, q, 1, m)
```